{% extends "base.html" %}
{% block content %}
<h2>Manager Dashboard</h2>
<p>View comprehensive analytics and ticket statistics.</p>

<div style="margin-bottom: 20px;">
    <a href="/manager/download-report" style="display: inline-block; padding: 12px 24px; background: #2196F3; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">Download Report</a>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <h3>Total Tickets</h3>
        <p class="stat-number">{{ total_tickets }}</p>
    </div>
    <div class="stat-card">
        <h3>Open Tickets</h3>
        <p class="stat-number" style="color: #ff6b6b;">{{ open_tickets }}</p>
    </div>
    <div class="stat-card">
        <h3>In Progress</h3>
        <p class="stat-number" style="color: #ffa500;">{{ in_progress_tickets }}</p>
    </div>
    <div class="stat-card">
        <h3>Closed Tickets</h3>
        <p class="stat-number" style="color: #51cf66;">{{ closed_tickets }}</p>
    </div>
</div>

<div class="charts-container">
    <div class="chart-card">
        <h3>Ticket Status Distribution</h3>
        <canvas id="statusChart"></canvas>
    </div>
    <div class="chart-card">
        <h3>Priority Distribution</h3>
        <canvas id="priorityChart"></canvas>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin: 20px 0 30px 0;
}

.stat-card {
    background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
    padding: 25px;
    border-radius: 12px;
    color: white;
    text-align: center;
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
}

body.dark-mode .stat-card {
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
}

.stat-card h3 {
    margin: 0 0 12px 0;
    font-size: 15px;
    opacity: 0.95;
    font-weight: 600;
}

.stat-number {
    font-size: 42px;
    font-weight: bold;
    margin: 0;
}

.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

.chart-card {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
}

body.dark-mode .chart-card {
    background: #2a2a2a;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
}

.chart-card h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #333;
    font-size: 18px;
}

body.dark-mode .chart-card h3 {
    color: #e0e0e0;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const statusCtx = document.getElementById('statusChart').getContext('2d');
new Chart(statusCtx, {
    type: 'doughnut',
    data: {
        labels: ['Open', 'In Progress', 'Closed'],
        datasets: [{
            data: [{{ open_tickets }}, {{ in_progress_tickets }}, {{ closed_tickets }}],
            backgroundColor: ['#ff6b6b', '#ffa500', '#51cf66'],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: { size: 13 }
                }
            }
        }
    }
});

const priorityCtx = document.getElementById('priorityChart').getContext('2d');
new Chart(priorityCtx, {
    type: 'bar',
    data: {
        labels: ['Low', 'Medium', 'High'],
        datasets: [{
            label: 'Tickets',
            data: [{{ low_priority }}, {{ medium_priority }}, {{ high_priority }}],
            backgroundColor: ['#2196F3', '#ffa500', '#ff6b6b'],
            borderRadius: 8,
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { stepSize: 1 },
                grid: { color: 'rgba(0,0,0,0.05)' }
            },
            x: {
                grid: { display: false }
            }
        }
    }
});
</script>

{% endblock %}
