{% extends "base.html" %}

{% block title %}Manager Dashboard{% endblock %}

{% block content %}
<div class="page">
    <h2>Manager Dashboard</h2>
    
    <!-- Metrics Section -->
    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-number">{{ total_tickets }}</div>
            <div class="stat-label">Total Tickets</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ open_tickets }}</div>
            <div class="stat-label">Open Tickets</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ closed_tickets }}</div>
            <div class="stat-label">Closed Tickets</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ high_priority }}</div>
            <div class="stat-label">High Priority</div>
        </div>
    </div>

    <!-- Actions Section -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
        <a href="/manager/analytics" style="text-decoration: none;">
            <button style="width: 100%; margin-top: 0;">View Analytics</button>
        </a>
        <a href="/manager/report" style="text-decoration: none;">
            <button style="width: 100%; margin-top: 0;">Generate Report</button>
        </a>
    </div>

    <!-- User Management Section -->
    <div style="background-color: #fafafa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0;">
        <h2 style="margin-bottom: 20px;">IT Administrator Assignment</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div>
                <h3 style="color: #333; margin-bottom: 15px;">Managers ({{ managers|length }})</h3>
                <div style="background: white; border-radius: 8px; padding: 15px;">
                    {% for user in managers %}
                    <div style="padding: 8px 0; border-bottom: 1px solid #eee;">{{ user.username }}</div>
                    {% endfor %}
                </div>
            </div>
            <div>
                <h3 style="color: #333; margin-bottom: 15px;">Admins ({{ admins|length }})</h3>
                <div style="background: white; border-radius: 8px; padding: 15px;">
                    {% for user in admins %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <span>{{ user.username }}</span>
                        <form method="post" action="/manager/assign-admin" style="display: inline;">
                            <input type="hidden" name="user_id" value="{{ user.id }}">
                            <input type="hidden" name="action" value="demote">
                            <button type="submit" class="small" style="background: #ff9800; margin: 0;">Demote</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div>
                <h3 style="color: #333; margin-bottom: 15px;">Regular Users ({{ regular_users|length }})</h3>
                <div style="background: white; border-radius: 8px; padding: 15px;">
                    {% for user in regular_users %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <span>{{ user.username }}</span>
                        <form method="post" action="/manager/assign-admin" style="display: inline;">
                            <input type="hidden" name="user_id" value="{{ user.id }}">
                            <input type="hidden" name="action" value="promote">
                            <button type="submit" class="small" style="background: #4caf50; margin: 0;">Promote</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}